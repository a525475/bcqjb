import{k as C,y,s as I,r as k,l as x,b as v,w as s,u as l,ad as R,d as r,a as t,af as u,ae as d,ah as F,ag as B,n as S,j as g,N as V,B as U,i as b}from"./index-wKIbGhGo.js";import{a as z}from"./index-ngrFHoWO.js";import{C as L}from"./CloudUpload-bfszKK-e.js";import{_ as q}from"./_plugin-vue_export-helper-DlAUqK2U.js";const O={class:"optional-fields"},j={class:"form-actions"},A=C({__name:"url",emits:["cancel","ok"],setup(D,{emit:_}){const m=y(),n=I(),p=k(),i=k(!1),f=_,N=()=>{f("cancel")},a=x({name:"",url:"",server:"",wsUrl:""}),w={name:[{required:!0,message:"请输入角色名称",trigger:"blur"},{min:1,max:50,message:"名称长度应在1到50个字符之间",trigger:"blur"}],url:[{required:!0,message:"请输入Token获取地址",trigger:"blur"},{type:"url",message:"请输入有效的URL地址",trigger:"blur"}]},T=()=>{p.value.validate(async c=>{if(c){i.value=!0;try{const e=await z.get(a.url);if(e.status===200&&e.data&&e.data.token){const o={name:a.name,token:e.data.token,server:a.server||"未知",wsUrl:a.wsUrl||"",id:Date.now().toString()};m.addToken(o),n.success("Token添加成功"),a.name="",a.url="",a.server="",a.wsUrl="",f("ok")}else n.error("接口返回数据格式不正确，未找到token字段")}catch{n.error("获取Token失败，请检查URL地址或网络连接")}finally{i.value=!1}}else n.error("请修正表单中的错误后再提交")})};return(c,e)=>(b(),v(l(R),{ref_key:"urlFormRef",ref:p,model:a,rules:w,"label-placement":"top",size:"large"},{default:s(()=>[r(l(d),{label:"游戏角色名称",path:"name"},{default:s(()=>[r(l(u),{value:a.name,"onUpdate:value":e[0]||(e[0]=o=>a.name=o),placeholder:"例如：主号战士",clearable:""},null,8,["value"])]),_:1}),r(l(d),{label:"Token获取地址",path:"url"},{feedback:s(()=>[...e[4]||(e[4]=[t("div",{class:"form-tips"},[t("span",{class:"form-tip"}," 接口应返回包含token字段的JSON数据 "),t("span",{class:"form-tip cors-tip"}," 注意：如果是跨域URL，服务器需要支持CORS，否则会被浏览器阻止 ")],-1)])]),default:s(()=>[r(l(u),{value:a.url,"onUpdate:value":e[1]||(e[1]=o=>a.url=o),placeholder:"输入API接口地址...",clearable:""},null,8,["value"])]),_:1}),r(l(B),null,{default:s(()=>[r(l(F),{title:"角色详情 (可选)",name:"optional"},{default:s(()=>[t("div",O,[r(l(d),{label:"服务器"},{default:s(()=>[r(l(u),{value:a.server,"onUpdate:value":e[2]||(e[2]=o=>a.server=o),placeholder:"服务器名称"},null,8,["value"])]),_:1}),r(l(d),{label:"自定义连接地址"},{default:s(()=>[r(l(u),{value:a.wsUrl,"onUpdate:value":e[3]||(e[3]=o=>a.wsUrl=o),placeholder:"留空使用默认连接"},null,8,["value"])]),_:1})])]),_:1})]),_:1}),t("div",j,[r(l(U),{type:"primary",size:"large",block:"",loading:i.value,onClick:T},{icon:s(()=>[r(l(V),null,{default:s(()=>[r(l(L))]),_:1})]),default:s(()=>[e[5]||(e[5]=g(" 获取并添加Token ",-1))]),_:1},8,["loading"]),l(m).hasTokens?(b(),v(l(U),{key:0,size:"large",block:"",onClick:N},{default:s(()=>[...e[6]||(e[6]=[g(" 取消 ",-1)])]),_:1})):S("",!0)])]),_:1},8,["model"]))}}),h=q(A,[["__scopeId","data-v-dcd99aaf"]]);export{h as default};
